# RMP

A dashboard for analysis of the RMP website. This repository contains the files
used to build the
[lit-codes/rmp](https://hub.docker.com/repository/docker/litcodes/rmp) image.
The image contains the API and the front-end application based on
[Cube.js](https://cube.dev/) and PostgreSQL.

## Environment file

Local development is possible by putting the environment variables inside a
`.env` file in the root of this repo and running `npm start`. 

An example of such file is:

```
LOGIN_PASSWORD=[adminpassword] # Replace with a password to login from web
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=[rmppassword] # Replace with Redis password
CUBEJS_DB_HOST=localhost
CUBEJS_DB_NAME=rmp
CUBEJS_DB_USER=rmp
CUBEJS_DB_PASS=[dbpassword] # Replace with PostgreSQL password
CUBEJS_WEB_SOCKETS=true
CUBEJS_DB_TYPE=postgres
CUBEJS_API_SECRET=[apisecrethash] # Replace with the API secret created by the CubeJS CLI
```

## Run in development mode

To run the development environment:

```bash
npm install
npm run dev
```

## Run in production mode

Or run the server in production mode:

```bash
npm install
npm start
```

This will ask for a password to login, default username/password is set in the
`.env` file to `admin`/`admin`.

## Access the database

To run the API, you will need a working database with the schema matching the
rmp-db. You can either create a new database with that schema, or connect to
the database running in Kubernetes.

### To port-forward the Kubernetes DB

```bash
kubectl port-forward `kubectl get pod -l app=rmp-db -o name` 5432
```

This command listens on your localhost:5432 (make sure the port is not taken
already), and redirects the traffic to the `rmp-db` pod essentially connecting
you to the production environment.

### To port-forward the Redis server

Redis server is required if you want to run the API in production mode. We can
redirect the localhost:6379 to the production Redis server, similar to what we
did for the DB.

```bash
kubectl port-forward `kubectl get pod -l app=rmp-redis -o name` 6379
```

Redis is used for in-memory caching, see https://cube.dev/docs/caching/ for
more info.

# File structure

## dashboard-app

This is the front-end application written in ReactJS and auto-generated by
CubeJS. In the future this will be our website and is probably hosted on either
Vercel or Netlify.

## index.js

This is our backend code, currently pretty dumb, and does nothing useful but
handling authentication and serving the front-end static content.

## .env

Contains the environments needed for Cube.js to work, including DB and Redis
passwords and addresses.

# To build the image

To build and push the image you can run the `build.sh`, see [how to build the
images](../README.md#how-to-build-the-images).

# Work-in-Progress

If you came accross this repo, please note that this is a work-in-progress and
at the moment it's not more than a proof-of-concept. Stay tuned for more.

For more information contact us at info at lit.codes.
